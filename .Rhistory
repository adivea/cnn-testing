ggtitle("Missing and detected mounds with 60%+ probability")
cnnall_grid %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")
cnnall_grid %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds,
aes(alpha = 0.6))
cnnall_grid %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds)
# See the unpredicted 627 mounds
cnn_grid %>%
# filter(mound_probability>0.5) %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
#geom_sf(data = unpredicted$geometry)+
geom_sf(data = mounds$geometry[mounds$predicted60 == "no"], size = mounds$Height[mounds$predicted60 == "no"], col = "lightgrey", alpha = 0.5)
# See the predicted 146/166 mound features of all sizes
cnn_grid %>%
# filter(mound_probability>0.5) %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds$geometry[mounds$predicted60 == "yes"], size = mounds$Height[mounds$predicted60 == "yes"], col = "lightgrey", alpha = 0.5) +
ggtitle("Predicted mounds in Kazanlak")
# See the unpredicted 627 mounds
cnn_grid %>%
# filter(mound_probability>0.5) %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
#geom_sf(data = unpredicted$geometry)+
geom_sf(data = mounds$geometry[mounds$predicted60 == "no"], size = mounds$Height[mounds$predicted60 == "no"], col = "lightgrey", alpha = 0.5)
ggtitle("unpredicted mounds in Kazanlak")
cnnall_grid %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds)
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability)) +
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted60)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Missing and detected mounds with 60%+ probability")
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability,
name = "Probability of mound")) +
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted60)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Missing and detected mounds with 60%+ probability")
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability)) +
labs(fill = "Probability of mound")+
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted60)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Missing and detected mounds with 60%+ probability")
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability)) +
labs(fill = "Probability of mound")+
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted60)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Mounds located in gridcells with 60%+ probability")
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability)) +
labs(fill = "Probability of mound")+
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted60)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Mounds located in gridcells with 60%+ probability (no=620, yes=146)")
plot(survey_ch, col = "green", main = "Convex hull around survey area (small and large)");plot(survey_sm, col = "red", alpha=0.5, add = TRUE); plot(survey$geometry, add =TRUE)
# View all mounds
plotRGB(kaz, stretch= "lin", main = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds");
plot(survey_ch, col = "green", add = TRUE, main = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds");
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE, main = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend(legend = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("top", legend = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("bottom", legend = "Predicted cells with 60%+ probability of mounds /n overlayed on satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("bottom", legend = "Predicted cells with 60%+ probability of mounds \n overlayed on satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("bottom", legend = "Predicted cells with 60%+ probability of mounds  overlayed on \nthe satellite image and survey study area with mounds")
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("bottom", legend = "Grid cells with 60%+ probability of mounds (white squares) overlayed on \nthe satellite image and survey study area outlines with mounds (pink circles)")
str(predicted)  #146 unique features among 166 features caught via intersecton
head(predicted,2)  #146 unique features among 166 features caught via intersecton
hist(mounds$Height[mounds$predicted60 == "no"], col = "pink", breaks  = 20);
hist(mounds$Height[mounds$predicted60 == "yes"], col = "yellow", add =TRUE, alpha = 0.5);
legend("top", legend = "Histogram of detected (yellow) and undetected (pink) mounds by height")
hist(mounds$Height[mounds$predicted60 == "no"], col = "pink", breaks  = 20,main = "Histogram of detected (yellow) and undetected (pink) mounds by height");
hist(mounds$Height[mounds$predicted60 == "yes"], col = "yellow", add =TRUE, alpha = 0.5);
hist(mounds$Height[mounds$predicted60 == "no"], col = "pink", breaks  = 20,main = "Histogram of detected (yellow) and undetected (pink) mounds by height",
xlab = "Height(m)");
hist(mounds$Height[mounds$predicted60 == "yes"], col = "yellow", add =TRUE, alpha = 0.5);
# Check the height difference between un- and predicted mounds
boxplot(Height~predicted60, data = mounds, xlab = "Was mound detected?")
length(duplicated(missing$TRAP_Code))
mapview(unpredicted, color = "orange", alpha= 0.5,
map.types = c("Esri.WorldImagery", "CartoDB.Positron"),
layer.name = "Undetected mounds")+
mapview(grids_n_mounds, zcol = "n", at = c(1, 2, 5, 10, 15, 30),
layer.name = "Detected mound no per gridcell")+
survey_grids60
par(mfrow = c(1,2))
# Look at the predicted and un=predicted mounds
plotRGB(kaz, stretch= "lin");
legend("top", legend = "Detection differences by mound height")
plot(mounds$geometry[mounds$predicted60 == "no"], add = TRUE, col = "red")
plot(mounds$geometry[mounds$predicted60 == "yes"], add = TRUE, col = "green")
plot(cnn_grid$geometry, add = TRUE, border = "white")
legend(x = "bottom",          # Position
legend = c("undetected", "detected",
"grids with 60%+ mound probability"),  # Legend texts
pch = c(1,1,0),       # Symbol shapes
col = c("red","green", "lightgrey"))           # Line colors
# View Large mounds only
plotRGB(kaz, stretch= "lin");
plot(mounds$geometry[mounds$predicted60 == "no" & mounds$Height >=2], add = TRUE, col = "red")
plot(mounds$geometry[mounds$predicted60 == "yes"& mounds$Height >=2], add = TRUE, col = "green")
plot(cnn_grid$geometry, add = TRUE, border = "white")
legend(x = "bottom",          # Position
legend = c("undetected 2m+ mounds", "detected 2m+ mounds",
"grids with 60%+ mound probability"),  # Legend texts
pch = c(1,1,0),       # Symbol shapes
col = c("red","green", "lightgrey"))           # Line colors
knitr::opts_chunk$set(echo = TRUE,
message = FALSE,
warning = FALSE)
library(tidyverse)
library(sf)
library(raster)
knitr::opts_chunk$set(echo = TRUE,
message = FALSE,
warning = FALSE)
library(tidyverse)
library(sf)
library(raster)
# Load the merged Satellite image for Kazanlak Valley, Bulgaria
# use cds-spatial repo from github https://github.com/CDS-AU-DK/cds-spatial
kaz <-brick("../1_Teaching/cds-spatial/data/Kaz.tif")
plotRGB(kaz, stretch= "lin")
crs(kaz)
# Load prediction data as points (left bottom corner of the evaluated cell)
cnne_df <- read_csv("2021-10-25.predictions/results/east/east.csv")
# 15334 points (origins in the raster cells)
cnnw_df <- read_csv("2021-10-25.predictions/results/west/west.csv")
# 15334 points (origins in the raster cells)
cnn_df <- rbind(cnne_df, cnnw_df)
# 30504 rows
# Check the probabilities of there being a mound in a given cell
hist(cnn_df$mound_probability,
main = "Probability of mound present in a satellite image gridcell");abline(v=0.6, col="red", lty = 2, lwd = 3)
table(cut(cnn_df$mound_probability, c(0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)))
# ok, so there is an exponential drop-off.
### Build a grid of those with 80%+ probability of containing a mound
# Build a grid from all points
#cnnall_sp <- st_as_sf(cnn_df, coords = c("x","y"), crs = 32635)
#cnnall_grid <- st_make_grid(cnnall_sp, cellsize = 250, what = "polygons")
# Filter predictions to those that have 80+% likelihood of containing a mound
cnn80_sp <- cnn_df %>%
filter(mound_probability =>0.80) %>%  #333 observations
### Build a grid of those with 80%+ probability of containing a mound
# Build a grid from all points
#cnnall_sp <- st_as_sf(cnn_df, coords = c("x","y"), crs = 32635)
#cnnall_grid <- st_make_grid(cnnall_sp, cellsize = 250, what = "polygons")
# Filter predictions to those that have 80+% likelihood of containing a mound
cnn80_sp <- cnn_df %>%
filter(mound_probability >0.799) %>%  #333 observations
st_as_sf(coords = c("x","y"), crs = 32635)
# Make a grid of 60%+ cells, 382 cells, 332 unique ones
cnn_grid <- st_make_grid(cnn60_sp, cellsize = 250, what = "polygons")
#plot(cnn_grid)
# Add probability data to the 60%+ grid
#cnnall_datagrid <- st_join(st_sf(cnnall_grid), cnnall_sp)
cnn_grid <- st_join(st_sf(cnn_grid), cnn60_sp)
# Visualize the grid cells with higher probability
ggplot(cnn_grid) +
geom_sf(aes(color = mound_probability))
# 333 raster cells are predicted to contain mounds with greater
# than 60% likelihood. Archaeologists found 773 mounds in fraction of the area
# View the grid
plotRGB(kaz, stretch= "lin");
plot(cnn_grid$geometry, add = TRUE, border = "white")
# Make a grid of 60%+ cells, 382 cells, 332 unique ones
cnn_grid <- st_make_grid(cnn80_sp, cellsize = 250, what = "polygons")
# Add probability data to the 60%+ grid
#cnnall_datagrid <- st_join(st_sf(cnnall_grid), cnnall_sp)
cnn_grid <- st_join(st_sf(cnn_grid), cnn60_sp)
library(tidyverse)
library(sf)
library(raster)
# Load the merged Satellite image for Kazanlak Valley, Bulgaria
# use cds-spatial repo from github https://github.com/CDS-AU-DK/cds-spatial
kaz <-brick("../1_Teaching/cds-spatial/data/Kaz.tif")
plotRGB(kaz, stretch= "lin")
crs(kaz)
# Load prediction data as points (left bottom corner of the evaluated cell)
cnne_df <- read_csv("2021-10-25.predictions/results/east/east.csv")
# 15334 points (origins in the raster cells)
cnnw_df <- read_csv("2021-10-25.predictions/results/west/west.csv")
# 15334 points (origins in the raster cells)
cnn_df <- rbind(cnne_df, cnnw_df)
# 30504 rows
# Check the probabilities of there being a mound in a given cell
hist(cnn_df$mound_probability,
main = "Probability of mound present in a satellite image gridcell");abline(v=0.6, col="red", lty = 2, lwd = 3)
table(cut(cnn_df$mound_probability, c(0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)))
# ok, so there is an exponential drop-off.
### Build a grid of those with 80%+ probability of containing a mound
# Build a grid from all points
#cnnall_sp <- st_as_sf(cnn_df, coords = c("x","y"), crs = 32635)
#cnnall_grid <- st_make_grid(cnnall_sp, cellsize = 250, what = "polygons")
# Filter predictions to those that have 80+% likelihood of containing a mound
cnn80_sp <- cnn_df %>%
filter(mound_probability >0.799) %>%  #333 observations
st_as_sf(coords = c("x","y"), crs = 32635)
# Make a grid of 80%+ cells, 382 cells, 332 unique ones
cnn_grid <- st_make_grid(cnn80_sp, cellsize = 250, what = "polygons")
#plot(cnn_grid)
# Add probability data to the 80%+ grid
#cnnall_datagrid <- st_join(st_sf(cnnall_grid), cnnall_sp)
cnn_grid <- st_join(st_sf(cnn_grid), cnn80_sp)
# Visualize the grid cells with higher probability
ggplot(cnn_grid) +
geom_sf(aes(color = mound_probability))
# 333 raster cells are predicted to contain mounds with greater
# than 80% likelihood. Archaeologists found 773 mounds in fraction of the area
# View the grid
plotRGB(kaz, stretch= "lin");
plot(cnn_grid$geometry, add = TRUE, border = "white")
# Bring in all the mounds observed in the field
mounds <- st_read("../1_Teaching/cds-spatial/data/KAZ_mounds.shp")
plot(mounds$geometry, main = "Mounds found through survey")
# Bring in survey area to see overall coverage
survey <- st_read("../1_Teaching/cds-spatial/data/KAZ_surveyarea.shp")
plot(survey$geometry, main = "Area covered by survey")
# Extrapolate rough study area after subtracting outliers
far <- mounds %>%
st_is_within_distance(survey, 1500) %>%
lengths>0
farmounds <- which(far==0)  # these are the mounds that are mostly far from survey area
# convex hull of points without outliers
survey_sm <- st_convex_hull(st_union(mounds$geometry[-farmounds]))
# convex hull of survey polygons
survey_ch <- st_convex_hull(st_union(survey$geometry))
# quickly see the difference in bounding boxes
plot(survey_ch, col = "green", main = "Convex hull around survey area (tight and extensive)");plot(survey_sm, col = "red", alpha=0.5, add = TRUE); plot(survey$geometry, add =TRUE)
# View all mounds
plotRGB(kaz, stretch= "lin");
plot(survey_ch, col = "green", add = TRUE);
plot(survey_sm, col = "red", add = TRUE);
plot(survey$geometry, col = "lightyellow", add = TRUE );
plot(mounds$geometry[-farmounds,], add = TRUE, col = "pink");
plot(cnn_grid$geometry, add = TRUE, border = "white");
legend("bottom", legend = "Grid cells with 80%+ probability of mounds (white squares) overlayed on \nthe satellite image and survey study area outlines with mounds (pink circles)")
# Bring in mound attributes (n = 773) to aid exploration
mounddata <- read_csv("../1_Teaching/cds-spatial/data/KAZ_mdata.csv")
mounds <- mounds %>%
left_join(mounddata, by = c("TRAP_Code"="MoundID"))
# Select gridcells that fall within TRAP study area
survey_grids80 <- st_intersection(survey_ch, cnn_grid) # 192 grid cells with 80%+
#plot(survey_grids80)
# Check spatial overlap between 80%+ grid cells and all 773 mounds
predicted <- st_intersection(mounds, cnn_grid)# %>% distinct()
# Which ones are not-predicted?
`%nin%` = Negate(`%in%`)
unpredicted <- mounds[mounds$TRAP_Code%nin%predicted$TRAP_Code,] # 627 not predicted
head(predicted,2)  #146 unique features among 166 features caught via intersecton
length(unique(predicted$TRAP_Code)) # 146 unique mounds
length(unique(cnn_grid$X1)) #332 unique cells
grids_n_mounds <- predicted %>%
#  st_drop_geometry() %>%
group_by(X1) %>%
count()
length(unique(grids_n_mounds$X1)) # all the detected mounds are withing 51 grids, out of which one is labelled NA, so 50 it is
hist(grids_n_mounds$n, breaks = 40, main = "Frequency of predicted mounds (146) per grid cell(n = 50")
# Summary: 50 out of 332 Grid cells with 80%+ probability contain between 1 and 29 detected mounds, which makes sense for the necropolis of little 10m diameter mounds in the NW
# Add the information on prediction to mound dataset
mounds <- mounds %>%
mutate(predicted80 =  case_when(TRAP_Code %in% predicted$TRAP_Code ~ "yes",
TRAP_Code %nin% predicted$TRAP_Code ~ "no"
))
# Look at the predicted and un=predicted mounds
unpredicted <- mounds[mounds$TRAP_Code%nin%predicted$TRAP_Code,]
plot(unpredicted$geometry, col = "red", main = "Mounds predicted (green) and unpredicted (red) by CNN");plot(predicted$geometry, col = "darkgreen", add= TRUE);
# filter the mounds for largesh and noticeable ones (2+ meters)
large <- mounds %>%
filter(Height>=2) # 247 obs
mounds %>%
group_by(predicted80) %>%
summarize(min = min(Height), max = max(Height))
# Check the height difference between un- and predicted mounds
boxplot(Height~predicted80, data = mounds, xlab = "Was mound detected?")
# Check height distribution btw un- and predicted mounds
hist(mounds$Height[mounds$predicted80 == "no"], col = "pink", breaks  = 20,main = "Histogram of detected (yellow) and undetected (pink) mounds by height",
xlab = "Height (m)");
hist(mounds$Height[mounds$predicted80 == "yes"], col = "yellow", add =TRUE, alpha = 0.5);
# Is there a significant relationship between the Height of a mound and its detection?
t.test(Height ~ as.factor(predicted80), data = mounds)
str(t.test(Height ~ as.factor(predicted80), data = mounds))
# ... the answer seems to be yes with p at 3.14e-05
# Create a grid of ALL the predictions to see where the remaining 627 unpredicted mounds are
cnnall_sp <- st_as_sf(cnn_df, coords = c("x","y"), crs = 32635)
#plot(cnnall_sp)
cnnall_grid <- st_make_grid(cnnall_sp, cellsize = 250, what = "polygons")
#plot(cnnall_grid) # we can see that the cells overlap in the middle
cnnall_grid <- st_join(st_sf(cnnall_grid), cnnall_sp) # add attributes
# Trying to eliminate overlap in gridcells
# eliminating id duplicates is nonsensical as the two datasets have same ids, I  must aggregate spatially, e.g. st_union or st_difference, or relabel the datasets before merging, or crop to a shared non-overlapping border.
missing <- st_intersection(unpredicted, cnnall_grid) # 2158, clearly duplicates
# Check for duplicates
?distinct()
length(duplicated(missing$TRAP_Code)) # 2158 points to duplication
missing <- missing[!duplicated(missing$TRAP_Code),] #620 undetected mounds
# How many grids are the missing mounds in?
missing %>%
st_drop_geometry() %>%
group_by(X1) %>%
tally() %>% arrange(desc(n))
# The missing 620 mounds are contained within 259 grid cells of the satellite image
# Let's see the distribution of missing mounds per grid cell
missing %>%
group_by(X1) %>%
count() %>%
ggplot()+ geom_histogram(aes(n))+ggtitle("Count of undetected mounds (620) per gridcell(n=259)") + theme_bw()
# some gridcells contain up to 28 undetected mounds. No surprise with the NW necropolis
# What is the mound_probability in these gridcells?
hist(missing$mound_probability, main = "Probability of gridcells containing undetected mounds")
# Ggplot of mounds with high prob and grid with high prob
# missing %>%
#   filter(mound_probability>0.59) %>%
#   ggplot()+
#   geom_sf(aes(color = mound_probability))+
#   geom_sf(data = cnn_grid, alpha = 0.5)
library(mapview)
missing %>%
filter(mound_probability>0.59) %>%
mapview(color = "red")+
# mapview(cnn_grid, alpha = 0.5)+
mapview(cnnall_grid, zcol= "mound_probability")
# See the predicted mounds over grids with 80% likelihood of mound plus unpredicted mounds
library(mapview)
mapview(unpredicted, color = "orange", alpha= 0.5,
map.types = c("Esri.WorldImagery", "CartoDB.Positron"),
layer.name = "Undetected mounds")+
mapview(grids_n_mounds, zcol = "n", at = c(1, 2, 5, 10, 15, 30),
layer.name = "Detected mound no per gridcell")+
mapview(survey_grids80, layer.name = "Gridcells with 80%+ probability")
# Where are the mounds vis-a-vis the probability values
cnnall_grid %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds) +
ggtitle("Location of known mounds vis-a-vis the CNN predictions")
# See the 146/166 mound features predicted with 80%+ probability
cnn_grid %>%
# filter(mound_probability>0.5) %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
geom_sf(data = mounds$geometry[mounds$predicted80 == "yes"], size = mounds$Height[mounds$predicted80 == "yes"], col = "lightgrey", alpha = 0.5) +
ggtitle("Predicted mounds in Kazanlak")
# See the 627 mounds not caught by the cells with 80%+ probability
cnn_grid %>%
# filter(mound_probability>0.5) %>%
ggplot()+
geom_sf(aes(color = mound_probability))+
scale_color_gradient(low = "green",
high = "red",
"Mound probability")+
#geom_sf(data = unpredicted$geometry)+
geom_sf(data = mounds$geometry[mounds$predicted80 == "no"], size = mounds$Height[mounds$predicted80 == "no"], col = "lightgrey", alpha = 0.5)+
ggtitle("Unpredicted mounds in Kazanlak")
# Cumulative facetted visual
ggplot()+
geom_sf(data = cnn_grid, aes(fill = mound_probability)) +
labs(fill = "Probability of mound")+
# add mounds
geom_sf(data = mounds,
aes(size = Height, col = "red",  alpha = 0.6)) +
facet_wrap(~predicted80)+
theme_bw() +
guides(color = FALSE,
size = guide_legend(order = 1),
fill = guide_legend(order = 2),
alpha = FALSE)+
ggtitle("Mounds located in gridcells with 80%+ probability (no=620, yes=146)")
par(mfrow = c(1,2))
# Look at the predicted and un=predicted mounds
plotRGB(kaz, stretch= "lin");
legend("top", legend = "Detection differences by mound height")
plot(mounds$geometry[mounds$predicted80 == "no"], add = TRUE, col = "red")
plot(mounds$geometry[mounds$predicted80 == "yes"], add = TRUE, col = "green")
plot(cnn_grid$geometry, add = TRUE, border = "white")
legend(x = "bottom",          # Position
legend = c("undetected", "detected",
"grids with 80%+ mound probability"),  # Legend texts
pch = c(1,1,0),       # Symbol shapes
col = c("red","green", "lightgrey"))           # Line colors
# View Large mounds only
plotRGB(kaz, stretch= "lin");
plot(mounds$geometry[mounds$predicted80 == "no" & mounds$Height >=2], add = TRUE, col = "red")
plot(mounds$geometry[mounds$predicted80 == "yes"& mounds$Height >=2], add = TRUE, col = "green")
plot(cnn_grid$geometry, add = TRUE, border = "white")
legend(x = "bottom",          # Position
legend = c("undetected 2m+ mounds", "detected 2m+ mounds",
"grids with 80%+ mound probability"),  # Legend texts
pch = c(1,1,0),       # Symbol shapes
col = c("red","green", "lightgrey"))           # Line colors
predicted
length(unique(predicted$TRAP_Code)) # 146 unique mounds
